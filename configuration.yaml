# Standard Configuration
default_config:
homeassistant:
  customize: !include customize.yaml
  packages: !include_dir_named packages
frontend:
history:
logbook:
map:
sun:

# CONSOLIDATED TEMPLATES
template:
  - binary_sensor:
      - name: "Family Home WiFi"
        unique_id: family_home_wifi_presence
        device_class: presence
        state: >
          {{ is_state('sensor.alainas_iphone_ssid_2', 'Spencer') or 
             is_state('binary_sensor.johns_phone_static', 'on') or
             is_state('binary_sensor.ellas_phone_static', 'on') }}
      
      - name: "Michelle Present"
        unique_id: michelle_present_presence
        device_class: presence
        state: "{{ is_state('binary_sensor.michelle_phone_presence', 'on') }}"
      
      - name: "Anyone Home"
        unique_id: anyone_home_presence
        device_class: presence
        state: >
          {{ is_state('person.john_spencer', 'home') or 
             is_state('person.michelle', 'home') or 
             is_state('person.alaina', 'home') or 
             is_state('person.ella', 'home') }}
  
  - sensor:
      - name: "2nd Floor AP Clients"
        unique_id: 2nd_floor_ap_clients
        state: >
          {% set devices = ['device_tracker.alaina_iphone','device_tracker.ella_iphone','device_tracker.john_s24'] %}
          {{ devices | select('is_state', 'home') | list | count }}
        unit_of_measurement: "devices"

# Includes
# Handmade YAML automations
automation manual: !include_dir_merge_list automations/

# UI-created automations (blueprints work here)
automation ui: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# HTTP Configuration
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 172.30.33.0/24

# Homeassistant Configuration
# Adaptive Lighting
adaptive_lighting: !include adaptive_lighting.yaml

# Scene Index Helpers (CONSOLIDATED - NO DUPLICATES)
input_number:
  entry_room_scene_index:
    name: Entry Room Scene Index
    min: 0
    max: 9
    step: 1
    initial: 0
    mode: box
  bathroom_scene_index:
    name: Bathroom Scene Index
    min: 0
    max: 9
    step: 1
    initial: 0
    mode: box
  kitchen_lounge_scene_index:
    name: Kitchen Lounge Scene Index
    min: 0
    max: 9
    step: 1
    initial: 0
    mode: box
  kitchen_table_scene_index:
    name: Kitchen Table Scene Index
    min: 0
    max: 9
    step: 1
    initial: 0
    mode: box

# Input booleans - all defined in separate file
input_boolean: !include input_boolean.yaml

# Mobile Dashboard
lovelace:
  mode: storage
  dashboards:
    lovelace-kitchen-tablet:
      mode: yaml
      title: Kitchen Tablet
      filename: dashboards/lovelace-kitchen-tablet.yaml
      show_in_sidebar: true
      icon: mdi:tablet
    lovelace-mobile:
      mode: yaml
      title: Mobile
      icon: mdi:cellphone
      show_in_sidebar: true
      filename: dashboards/lovelace-mobile.yaml
    lovelace-climate:
      mode: yaml
      title: Climate Command
      icon: mdi:thermostat
      show_in_sidebar: true
      filename: dashboards/lovelace-climate.yaml

group: !include groups.yaml


# Ella's Ceiling Lights Group
light:
  - platform: group
    name: "Ella's Ceiling Lights"
    unique_id: ella_ceiling_lights_group
    entities:
      - light.ella_s_ceiling_light_1_of_3
      - light.ella_s_ceiling_light_2_of_3
      - light.ella_s_ceiling_light_3_of_3

# Trusted networks for tablet auto-login
auth:
  auth_providers:
    - type: trusted_networks
      trusted_networks:
        - 192.168.21.0/24
        - 192.168.1.0/24
      allow_bypass_login: true
    - type: homeassistant
input_select: !include input_select.yaml
input_datetime: !include input_datetime.yaml
counter: !include counter.yaml
timer: !include timer.yaml

# HAC Master Context Excel Auto-Export
shell_command:
  hac_export: 'bash -c "cd /homeassistant/hac && ./hac.sh export"'

automation:
  - alias: "HAC: Daily Master Context Export"
    description: "Auto-generate Master Context Excel at 3 AM"
    trigger:
      - platform: time
        at: "03:00:00"
    action:
      - service: shell_command.hac_export

packages: !include_dir_named packages
