# 2nd Floor Bathroom Motion Lighting
# Respects manual override from Inovelli switches
- id: upstairs_bathroom_motion_v3
  alias: "Upstairs Bathroom â†’ Motion Lighting v3"
  description: "Motion lighting with day/night modes, respects manual override"
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "on"
      id: motion_on
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "off"
      for:
        minutes: 8
      id: motion_off
  condition:
    # Don't run if manual override is active
    - condition: state
      entity_id: input_boolean.2nd_floor_bathroom_manual_override
      state: "off"
  action:
    - choose:
        # MOTION ON
        - conditions:
            - condition: trigger
              id: motion_on
          sequence:
            - choose:
                # NIGHT (11pm-6am) - Dim red
                - conditions:
                    - condition: time
                      after: "23:00:00"
                      before: "06:00:00"
                  sequence:
                    - action: scene.turn_on
                      target:
                        entity_id: scene.2nd_floor_vanity_lights_nightlight
                # EVENING (8pm-11pm) - Relax
                - conditions:
                    - condition: time
                      after: "20:00:00"
                      before: "23:00:00"
                  sequence:
                    - action: scene.turn_on
                      target:
                        entity_id: scene.2nd_floor_vanity_lights_relax
              # DAY - Energize
              default:
                - action: scene.turn_on
                  target:
                    entity_id: scene.2nd_floor_vanity_lights_energize
        # MOTION OFF - Turn off
        - conditions:
            - condition: trigger
              id: motion_off
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.2nd_floor_bathroom
              data:
                transition: 5
            # Clear manual override when lights turn off
            - action: input_boolean.turn_off
              target:
                entity_id: input_boolean.2nd_floor_bathroom_manual_override
