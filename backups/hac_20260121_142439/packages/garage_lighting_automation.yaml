# ============================================================================
# Garage Lighting & Door Automation
# Updated: 2026-01-20
# 
# LIGHTS CONTROLLED:
# - light.garage (Hue ceiling group)
# - light.ratgdo32disco_fd8d8c_light (North RATGDO opener)
# - light.ratgdo32disco_5735e8_light (South RATGDO opener)
# - light.garage_north_lift_master_garage_door_opener_west_light
# - light.garage_north_lift_master_garage_door_opener_east_light
# - light.south_west_garage_liftmaster
# - light.south_east_lift
# - light.garage_north_wall_nightlight (Third Reality)
# - light.garage_north_of_east_wall_motion_light_sensor (Third Reality)
# - light.garage_south_of_east_wall_motion_light_sensor (Third Reality)
# - light.garage_south_wall_motion_light_sensor (Third Reality)
# ============================================================================

automation:
  # === LIGHTS ON ===
  - id: garage_master_lights_on
    alias: "Garage All Lights ON"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: 'open'
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: 'open'
      - platform: state
        entity_id: binary_sensor.aqara_door_and_window_sensor_door_3
        to: 'on'
      - platform: state
        entity_id: binary_sensor.ratgdo32disco_5735e8_motion
        to: 'on'
      - platform: state
        entity_id: binary_sensor.ratgdo32disco_fd8d8c_motion
        to: 'on'
    action:
      - service: light.turn_on
        target:
          entity_id:
            # Hue ceiling group
            - light.garage
            # RATGDO opener lights
            - light.ratgdo32disco_fd8d8c_light
            - light.ratgdo32disco_5735e8_light
            # North LiftMaster
            - light.garage_north_lift_master_garage_door_opener_west_light
            - light.garage_north_lift_master_garage_door_opener_east_light
            # South LiftMaster (correct names)
            - light.south_west_garage_liftmaster
            - light.south_east_lift
            # Third Reality nightlights
            - light.garage_north_wall_nightlight
            - light.garage_north_of_east_wall_motion_light_sensor
            - light.garage_south_of_east_wall_motion_light_sensor
            - light.garage_south_wall_motion_light_sensor
        data:
          brightness_pct: 100
    mode: restart

  # === LIGHTS OFF ===
  - id: garage_master_lights_off
    alias: "Garage All Lights OFF"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.ratgdo32disco_5735e8_motion
          - binary_sensor.ratgdo32disco_fd8d8c_motion
        to: 'off'
        for:
          minutes: 6
    condition:
      - condition: state
        entity_id: cover.ratgdo32disco_5735e8_door
        state: 'closed'
      - condition: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        state: 'closed'
      - condition: state
        entity_id: binary_sensor.aqara_door_and_window_sensor_door_3
        state: 'off'
      - condition: state
        entity_id: binary_sensor.ratgdo32disco_5735e8_motion
        state: 'off'
      - condition: state
        entity_id: binary_sensor.ratgdo32disco_fd8d8c_motion
        state: 'off'
    action:
      - service: light.turn_off
        target:
          entity_id:
            - light.garage
            - light.ratgdo32disco_fd8d8c_light
            - light.ratgdo32disco_5735e8_light
            - light.garage_north_lift_master_garage_door_opener_west_light
            - light.garage_north_lift_master_garage_door_opener_east_light
            - light.south_west_garage_liftmaster
            - light.south_east_lift
            - light.garage_north_wall_nightlight
            - light.garage_north_of_east_wall_motion_light_sensor
            - light.garage_south_of_east_wall_motion_light_sensor
            - light.garage_south_wall_motion_light_sensor
    mode: restart

  # === DOOR LEFT OPEN NOTIFICATION ===
  - id: garage_door_left_open_notification
    alias: "Garage Door Left Open - Reminder"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: "open"
        for:
          minutes: 1
        id: north
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: "open"
        for:
          minutes: 1
        id: south
    action:
      - service: notify.mobile_app_john_s_phone
        data:
          title: "üöó Garage Door Open"
          message: "{{ trigger.id | title }} door has been open for 1 minute"
          data:
            tag: "garage_door_{{ trigger.id }}"
            ttl: 0
            priority: high
            persistent: true
            actions:
              - action: "GARAGE_CLOSE_{{ trigger.id | upper }}"
                title: "Close"
              - action: "GARAGE_SNOOZE_10_{{ trigger.id | upper }}"
                title: "10m"
              - action: "GARAGE_SNOOZE_30_{{ trigger.id | upper }}"
                title: "30m"
    mode: parallel

  # === DOOR OPENED - IMMEDIATE CLOSE OPTION (WINTER MODE) ===
  - id: garage_door_opened_close_option
    alias: "Garage Door Opened - Close Option"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: "open"
        id: north
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: "open"
        id: south
    action:
      - delay:
          seconds: 3
      - service: notify.mobile_app_john_s_phone
        data:
          title: "üöó {{ trigger.id | title }} Door Open"
          message: "Tap to close"
          data:
            tag: "garage_quick_close_{{ trigger.id }}"
            ttl: 0
            priority: high
            timeout: 120
            actions:
              - action: "GARAGE_CLOSE_{{ trigger.id | upper }}"
                title: "Close Now"
              - action: "GARAGE_AUTO_CLOSE_{{ trigger.id | upper }}"
                title: "Auto 10s"
    mode: parallel

  # === NOTIFICATION ACTIONS ===
  - id: garage_door_notification_actions
    alias: "Garage Door Notification Actions"
    trigger:
      # Close actions
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_CLOSE_NORTH"
        id: close_north
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_CLOSE_SOUTH"
        id: close_south
      # Auto-close actions (10 second delay)
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_AUTO_CLOSE_NORTH"
        id: auto_close_north
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_AUTO_CLOSE_SOUTH"
        id: auto_close_south
      # Snooze actions
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_SNOOZE_10_NORTH"
        id: snooze_10_north
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_SNOOZE_10_SOUTH"
        id: snooze_10_south
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_SNOOZE_30_NORTH"
        id: snooze_30_north
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "GARAGE_SNOOZE_30_SOUTH"
        id: snooze_30_south
    action:
      - choose:
          # CLOSE NORTH
          - conditions:
              - condition: trigger
                id: close_north
            sequence:
              - service: cover.close_cover
                target:
                  entity_id: cover.ratgdo32disco_fd8d8c_door
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_north"
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_quick_close_north"
          # CLOSE SOUTH
          - conditions:
              - condition: trigger
                id: close_south
            sequence:
              - service: cover.close_cover
                target:
                  entity_id: cover.ratgdo32disco_5735e8_door
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_south"
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_quick_close_south"
          # AUTO CLOSE NORTH (10s delay)
          - conditions:
              - condition: trigger
                id: auto_close_north
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "‚è±Ô∏è Auto-closing North"
                  message: "Closing in 10 seconds..."
                  data:
                    tag: "garage_quick_close_north"
                    timeout: 10
              - delay:
                  seconds: 10
              - service: cover.close_cover
                target:
                  entity_id: cover.ratgdo32disco_fd8d8c_door
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_quick_close_north"
          # AUTO CLOSE SOUTH (10s delay)
          - conditions:
              - condition: trigger
                id: auto_close_south
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "‚è±Ô∏è Auto-closing South"
                  message: "Closing in 10 seconds..."
                  data:
                    tag: "garage_quick_close_south"
                    timeout: 10
              - delay:
                  seconds: 10
              - service: cover.close_cover
                target:
                  entity_id: cover.ratgdo32disco_5735e8_door
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_quick_close_south"
          # SNOOZE 10 NORTH
          - conditions:
              - condition: trigger
                id: snooze_10_north
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_north"
              - delay:
                  minutes: 10
              - condition: state
                entity_id: cover.ratgdo32disco_fd8d8c_door
                state: "open"
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "üöó North Door Still Open"
                  message: "10 minute snooze ended"
                  data:
                    tag: "garage_door_north"
                    persistent: true
                    actions:
                      - action: "GARAGE_CLOSE_NORTH"
                        title: "Close"
                      - action: "GARAGE_SNOOZE_10_NORTH"
                        title: "10m"
                      - action: "GARAGE_SNOOZE_30_NORTH"
                        title: "30m"
          # SNOOZE 10 SOUTH
          - conditions:
              - condition: trigger
                id: snooze_10_south
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_south"
              - delay:
                  minutes: 10
              - condition: state
                entity_id: cover.ratgdo32disco_5735e8_door
                state: "open"
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "üöó South Door Still Open"
                  message: "10 minute snooze ended"
                  data:
                    tag: "garage_door_south"
                    persistent: true
                    actions:
                      - action: "GARAGE_CLOSE_SOUTH"
                        title: "Close"
                      - action: "GARAGE_SNOOZE_10_SOUTH"
                        title: "10m"
                      - action: "GARAGE_SNOOZE_30_SOUTH"
                        title: "30m"
          # SNOOZE 30 NORTH
          - conditions:
              - condition: trigger
                id: snooze_30_north
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_north"
              - delay:
                  minutes: 30
              - condition: state
                entity_id: cover.ratgdo32disco_fd8d8c_door
                state: "open"
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "üöó North Door Still Open"
                  message: "30 minute snooze ended"
                  data:
                    tag: "garage_door_north"
                    persistent: true
                    actions:
                      - action: "GARAGE_CLOSE_NORTH"
                        title: "Close"
                      - action: "GARAGE_SNOOZE_10_NORTH"
                        title: "10m"
                      - action: "GARAGE_SNOOZE_30_NORTH"
                        title: "30m"
          # SNOOZE 30 SOUTH
          - conditions:
              - condition: trigger
                id: snooze_30_south
            sequence:
              - service: notify.mobile_app_john_s_phone
                data:
                  message: "clear_notification"
                  data:
                    tag: "garage_door_south"
              - delay:
                  minutes: 30
              - condition: state
                entity_id: cover.ratgdo32disco_5735e8_door
                state: "open"
              - service: notify.mobile_app_john_s_phone
                data:
                  title: "üöó South Door Still Open"
                  message: "30 minute snooze ended"
                  data:
                    tag: "garage_door_south"
                    persistent: true
                    actions:
                      - action: "GARAGE_CLOSE_SOUTH"
                        title: "Close"
                      - action: "GARAGE_SNOOZE_10_SOUTH"
                        title: "10m"
                      - action: "GARAGE_SNOOZE_30_SOUTH"
                        title: "30m"
    mode: parallel
    max: 10

  # === CLEAR NOTIFICATION ON CLOSE ===
  - id: garage_door_closed_clear_notification
    alias: "Garage Door Closed - Clear Notification"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: "closed"
        id: north
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: "closed"
        id: south
    action:
      - service: notify.mobile_app_john_s_phone
        data:
          message: "clear_notification"
          data:
            tag: "garage_door_{{ trigger.id }}"
      - service: notify.mobile_app_john_s_phone
        data:
          message: "clear_notification"
          data:
            tag: "garage_quick_close_{{ trigger.id }}"
    mode: parallel
