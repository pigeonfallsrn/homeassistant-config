- 09:31: System cleanup: purged 28MB of accumulated backups (128 root, 83 hac/backups, 100+ hac/exports). Git tracks real history.
- 09:32: HAC alias fix: ~/.zshrc not reliably sourced in HA OS SSH addon. Put alias in /etc/profile.d/hac.sh for persistence across sessions and reboots.
- 10:06: SESSION 2026-02-26 SUMMARY:

SYSTEM AUDIT COMPLETED:
- 3,129 entities / 44 domains / 153 automations healthy
- Cleaned 28MB accumulated backups (128 root, 83 hac/backups, 100+ hac/exports)
- Git tracks history - .bak files unnecessary
- 1 pending update: Synology DSM 1.41→1.43

HAC ALIAS FIX:
- ~/.zshrc not reliably sourced in HA OS SSH addon
- Fixed: echo 'alias hac="/homeassistant/hac/hac.sh"' > /etc/profile.d/hac.sh
- Persists across sessions/reboots

AQARA M3 MATTER INTEGRATION (BLOCKED - NEXT SESSION):
- M3 hub online (device_tracker shows home), Aqara app working
- Child devices unavailable in HA (water leak x5, door sensor, plug, valves)
- Matter Server integration loaded but M3 not commissioned
- Power cycle M3 + HA restart did not resolve

NEXT SESSION ACTION:
1. Aqara App → Hub M3 → Settings → Matter → Generate NEW pairing code
2. HA → Settings → Devices → Add Integration → Matter → Commission with code
3. If fails: Factory reset M3, re-pair devices in Aqara app, then commission to HA
4. Consider ALSO adding via HomeKit Controller (exposes different device subset)

RESEARCH NOTES:
- Use BOTH Matter + HomeKit integrations (different devices exposed)
- M3 acts as Thread Border Router (extends mesh)
- IR blaster does NOT expose to HA
- Locks only via Matter, some sensors only via HomeKit
- Pet feeders need Zigbee2MQTT direct pairing
- 10:28: Matter recommission fix: Remove stale fabric from BOTH HA Matter integration AND Aqara Connected Ecosystems, then re-pair fresh. VLAN separation (IoT vs Default) not the issue - mDNS working across subnets.
- 10:55: Bathroom humidity fan best practice: Use derivative sensor (3 min window) for shower detection instead of absolute threshold. Triggers: rising >2%/min OR absolute >70%. Safety: 30 min max runtime, HA restart recovery, wait_for_trigger with timeout. Blackshome blueprint is community gold standard.
- 10:55: Entity naming: ZHA devices get generic entity_ids like inovelli_vzm35_sn_fan. Rename via ha_rename_entity to location-based IDs (e.g. fan.2nd_floor_bathroom_exhaust_fan) for maintainability. Device names are separate from entity IDs.
- 10:55: Matter recommission fix: Remove stale fabric from BOTH HA Matter integration AND Aqara Connected Ecosystems, then re-pair fresh. VLAN separation (IoT vs Default) not the issue - mDNS working across subnets.
