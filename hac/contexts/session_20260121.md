# Session 2026-01-21

- [19:06] Fixed lux automation rapid-fire: changed state triggers to numeric_state threshold crossings
- [19:06] Upgraded HAC to v6.0 with multi-file gist sync
- [19:10] Added 10s debounce (for: seconds: 10) to lux triggers to prevent rapid re-triggering
- [19:15] Fixed debounce - added for: 10s to dark_enough trigger
- [19:19] Clean fix: 30s debounce on lux triggers, proper YAML structure
- [19:34] Added 2s debounce to motion triggers + changed mode to single
- [19:37] Removed duplicate _fix.yaml files causing double triggers
- [19:40] SUCCESS: Lux rapid-fire fixed - removed duplicate _fix files, 30s lux debounce, 2s motion debounce, mode:single
- [19:42] Added condition: motion only triggers when light is OFF (prevents redundant triggers)
- [19:45] COMPLETE: Lux automation fix successful - triggers reduced from 6-8/sec to normal threshold-based
- [20:27] 2026-01-21: Fixed presence display to use sensor.*_ap_location with motion fallback. Created kids_bedroom_automation.yaml with wake lights (15min before Echo alarm), school night bedtime (9:30pm dim, 10:30pm off), and auto-off when leaving. Girls iPhones need Private WiFi Address OFF for UniFi ap_mac tracking. Dashboard Mobile updated to use sensor.*_status entities.
- [20:55] Fixed adaptive lighting double-trigger bug - condition logic now gates motion/lux to require light off. Added kitchen_lounge_manual_override. HAC v5 deployed with 05_health.md.
- [21:02] RULE: Always backup BEFORE sed. Pattern: cp file file.bak_$(date +%Y%m%d_%H%M%S) && sed ... && ha core check || cp file.bak_* file. Never use sed without this wrapper.
- [21:50] Fixed input_boolean.yaml include - was not being loaded. Merged overrides from configuration.yaml into input_boolean.yaml, changed to include statement. dad_bedtime_mode and party_mode now working.
