# ============================================================================
# Garage Lighting & Door Automation
# Updated: 2026-01-20
# 
# LIGHTS CONTROLLED:
# - light.garage (Hue ceiling group)
# - light.ratgdo32disco_fd8d8c_light (North RATGDO opener)
# - light.ratgdo32disco_5735e8_light (South RATGDO opener)
# - light.garage_north_lift_master_garage_door_opener_west_light
# - light.garage_north_lift_master_garage_door_opener_east_light
# - light.south_west_garage_liftmaster
# - light.south_east_lift
# - light.garage_north_wall_nightlight (Third Reality)
# - light.garage_north_of_east_wall_motion_light_sensor (Third Reality)
# - light.garage_south_of_east_wall_motion_light_sensor (Third Reality)
# - light.garage_south_wall_motion_light_sensor (Third Reality)
# ============================================================================

automation:
  # === LIGHTS ON ===
  - id: garage_master_lights_on
    alias: "Garage All Lights ON"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: 'open'
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: 'open'
      - platform: state
        entity_id: binary_sensor.aqara_door_and_window_sensor_door_3
        to: 'on'
      - platform: state
        entity_id: binary_sensor.ratgdo32disco_5735e8_motion
        to: 'on'
      - platform: state
        entity_id: binary_sensor.ratgdo32disco_fd8d8c_motion
        to: 'on'
    action:
      - service: light.turn_on
        target:
          entity_id:
            # Hue ceiling group
            - light.garage
            # RATGDO opener lights
            - light.ratgdo32disco_fd8d8c_light
            - light.ratgdo32disco_5735e8_light
            # North LiftMaster
            - light.garage_north_lift_master_garage_door_opener_west_light
            - light.garage_north_lift_master_garage_door_opener_east_light
            # South LiftMaster (correct names)
            - light.south_west_garage_liftmaster
            - light.south_east_lift
            # Third Reality nightlights
            - light.garage_north_wall_nightlight
            - light.garage_north_of_east_wall_motion_light_sensor
            - light.garage_south_of_east_wall_motion_light_sensor
            - light.garage_south_wall_motion_light_sensor
        data:
          brightness_pct: 100
    mode: restart

  # === LIGHTS OFF ===
  - id: garage_master_lights_off
    alias: "Garage All Lights OFF"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.ratgdo32disco_5735e8_motion
          - binary_sensor.ratgdo32disco_fd8d8c_motion
        to: 'off'
        for:
          minutes: 6
    condition:
      - condition: state
        entity_id: cover.ratgdo32disco_5735e8_door
        state: 'closed'
      - condition: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        state: 'closed'
      - condition: state
        entity_id: binary_sensor.aqara_door_and_window_sensor_door_3
        state: 'off'
      - condition: state
        entity_id: binary_sensor.ratgdo32disco_5735e8_motion
        state: 'off'
      - condition: state
        entity_id: binary_sensor.ratgdo32disco_fd8d8c_motion
        state: 'off'
    action:
      - service: light.turn_off
        target:
          entity_id:
            - light.garage
            - light.ratgdo32disco_fd8d8c_light
            - light.ratgdo32disco_5735e8_light
            - light.garage_north_lift_master_garage_door_opener_west_light
            - light.garage_north_lift_master_garage_door_opener_east_light
            - light.south_west_garage_liftmaster
            - light.south_east_lift
            - light.garage_north_wall_nightlight
            - light.garage_north_of_east_wall_motion_light_sensor
            - light.garage_south_of_east_wall_motion_light_sensor
            - light.garage_south_wall_motion_light_sensor
    mode: restart

  # === DOOR LEFT OPEN NOTIFICATION ===
  - id: garage_door_left_open_notification
    alias: "Garage Door Left Open - Reminder"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: "open"
        for:
          minutes: 1
        id: north
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: "open"
        for:
          minutes: 1
        id: south
    action:
      - service: notify.mobile_app_john_s_phone
        data:
          title: "ðŸš— Garage Door Open"
          message: "{{ trigger.id | title }} door has been open for 1 minute"
          data:
            tag: "garage_door_{{ trigger.id }}"
            ttl: 0
            priority: high
            persistent: true
            actions:
              - action: "GARAGE_CLOSE_{{ trigger.id | upper }}"
                title: "Close"
              - action: "GARAGE_SNOOZE_10_{{ trigger.id | upper }}"
                title: "10m"
              - action: "GARAGE_SNOOZE_30_{{ trigger.id | upper }}"
                title: "30m"
    mode: parallel

  # === CLEAR NOTIFICATION ON CLOSE ===
  - id: garage_door_closed_clear_notification
    alias: "Garage Door Closed - Clear Notification"
    trigger:
      - platform: state
        entity_id: cover.ratgdo32disco_fd8d8c_door
        to: "closed"
        id: north
      - platform: state
        entity_id: cover.ratgdo32disco_5735e8_door
        to: "closed"
        id: south
    action:
      - service: notify.mobile_app_john_s_phone
        data:
          message: "clear_notification"
          data:
            tag: "garage_door_{{ trigger.id }}"
      - service: notify.mobile_app_john_s_phone
        data:
          message: "clear_notification"
          data:
            tag: "garage_quick_close_{{ trigger.id }}"
    mode: parallel
