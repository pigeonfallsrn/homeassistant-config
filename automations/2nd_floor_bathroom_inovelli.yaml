# =============================================================================
# 2ND FLOOR BATHROOM - INOVELLI SWITCH AUTOMATIONS
# =============================================================================
# Ceiling Lights: VZM30-SN (0489781ef8d00419ecf1929bd865b2de) -> light.2nd_fl_bathroom_ceiling_lights
# Vanity Lights: VZM30-SN (602bdb2b4675a5e364853ac1e53ed689) -> light.2nd_floor_vanity_lights
# Exhaust Fan: VZM35-SN (3eed85f7ca546a7ed7e24b0cfc6c818b) -> switch.upstairs_bathroom_fan
# 
# BEST PRACTICE: Time-based scenes + adaptive lighting manual override
# - DAY (6am-8pm): Energize scene
# - EVENING (8pm-11pm): Relax scene  
# - NIGHT (11pm-6am): Nightlight scene (dim red)
# =============================================================================

# -----------------------------------------------------------------------------
# CEILING LIGHTS - Time-based scenes with AL override
# -----------------------------------------------------------------------------
- id: '2nd_floor_bathroom_ceiling_inovelli'
  alias: 2nd Floor Bathroom - Ceiling Lights Inovelli Control
  description: 'Time-based Hue scenes with adaptive lighting override'
  use_blueprint:
    path: fxlt/zha-inovelli-vzm31-sn-blue-series-2-1-switch.yaml
    input:
      inovelli_switch: 0489781ef8d00419ecf1929bd865b2de
      button_1:
      - action: light.turn_off
        target:
          entity_id: light.2nd_fl_bathroom_ceiling_lights
        data:
          transition: 2
      - action: adaptive_lighting.set_manual_control
        data:
          entity_id: switch.adaptive_lighting_upstairs_zone
          lights: light.2nd_fl_bathroom_ceiling_lights
          manual_control: false
      button_2:
      - action: adaptive_lighting.set_manual_control
        data:
          entity_id: switch.adaptive_lighting_upstairs_zone
          lights: light.2nd_fl_bathroom_ceiling_lights
          manual_control: true
      - choose:
        # NIGHT (11pm-6am) - Nightlight
        - conditions:
          - condition: time
            after: "23:00:00"
            before: "06:00:00"
          sequence:
          - action: light.turn_on
            target:
              entity_id: light.2nd_fl_bathroom_ceiling_lights
            data:
              brightness_pct: 5
              rgb_color: [255, 30, 0]
              transition: 1
        # EVENING (8pm-11pm) - Relax/warm
        - conditions:
          - condition: time
            after: "20:00:00"
            before: "23:00:00"
          sequence:
          - action: light.turn_on
            target:
              entity_id: light.2nd_fl_bathroom_ceiling_lights
            data:
              brightness_pct: 60
              color_temp_kelvin: 2700
              transition: 1
        # DAY (6am-8pm) - Energize
        default:
        - action: scene.turn_on
          target:
            entity_id: scene.2nd_fl_bathroom_ceiling_lights_energize
      button_1_hold:
      - action: light.turn_on
        target:
          entity_id: light.2nd_fl_bathroom_ceiling_lights
        data:
          brightness_step_pct: -10
      button_2_hold:
      - action: light.turn_on
        target:
          entity_id: light.2nd_fl_bathroom_ceiling_lights
        data:
          brightness_step_pct: 10

# -----------------------------------------------------------------------------
# VANITY LIGHTS - Time-based scenes with AL override
# -----------------------------------------------------------------------------
- id: '2nd_floor_bathroom_vanity_inovelli'
  alias: 2nd Floor Bathroom - Vanity Lights Inovelli Control
  description: 'Time-based Hue scenes with adaptive lighting override'
  use_blueprint:
    path: fxlt/zha-inovelli-vzm31-sn-blue-series-2-1-switch.yaml
    input:
      inovelli_switch: 602bdb2b4675a5e364853ac1e53ed689
      button_1:
      - action: light.turn_off
        target:
          entity_id: light.2nd_floor_vanity_lights
        data:
          transition: 2
      - action: adaptive_lighting.set_manual_control
        data:
          entity_id: switch.adaptive_lighting_upstairs_zone
          lights: light.2nd_floor_vanity_lights
          manual_control: false
      button_2:
      - action: adaptive_lighting.set_manual_control
        data:
          entity_id: switch.adaptive_lighting_upstairs_zone
          lights: light.2nd_floor_vanity_lights
          manual_control: true
      - choose:
        # NIGHT (11pm-6am) - Nightlight
        - conditions:
          - condition: time
            after: "23:00:00"
            before: "06:00:00"
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.2nd_floor_vanity_lights_nightlight
        # EVENING (8pm-11pm) - Relax
        - conditions:
          - condition: time
            after: "20:00:00"
            before: "23:00:00"
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.2nd_floor_vanity_lights_relax
        # DAY (6am-8pm) - Energize
        default:
        - action: scene.turn_on
          target:
            entity_id: scene.2nd_floor_vanity_lights_energize
      button_1_hold:
      - action: light.turn_on
        target:
          entity_id: light.2nd_floor_vanity_lights
        data:
          brightness_step_pct: -10
      button_2_hold:
      - action: light.turn_on
        target:
          entity_id: light.2nd_floor_vanity_lights
        data:
          brightness_step_pct: 10

# -----------------------------------------------------------------------------
# EXHAUST FAN - Humidity-based auto control with manual override
# -----------------------------------------------------------------------------
- id: '2nd_floor_bathroom_fan_humidity_on'
  alias: 2nd Floor Bathroom - Fan On (High Humidity)
  description: 'Turn on exhaust fan when humidity rises above threshold'
  mode: single
  trigger:
    - platform: numeric_state
      entity_id: sensor.aqara_temp_humidity_sensor_humidity_4
      above: 65
      for:
        minutes: 2
  condition:
    - condition: state
      entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
      state: 'off'
  action:
    - action: switch.turn_on
      target:
        entity_id: switch.upstairs_bathroom_fan

- id: '2nd_floor_bathroom_fan_humidity_off'
  alias: 2nd Floor Bathroom - Fan Off (Normal Humidity)
  description: 'Turn off exhaust fan when humidity drops below threshold'
  mode: single
  trigger:
    - platform: numeric_state
      entity_id: sensor.aqara_temp_humidity_sensor_humidity_4
      below: 55
      for:
        minutes: 5
  condition:
    - condition: state
      entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
      state: 'off'
  action:
    - action: switch.turn_off
      target:
        entity_id: switch.upstairs_bathroom_fan

# -----------------------------------------------------------------------------
# EXHAUST FAN - Inovelli switch manual control
# -----------------------------------------------------------------------------
- id: '2nd_floor_bathroom_fan_inovelli'
  alias: 2nd Floor Bathroom - Fan Inovelli Manual Control
  description: 'Inovelli fan switch - up/down control fan, config clears override'
  use_blueprint:
    path: fxlt/zha-inovelli-vzm31-sn-blue-series-2-1-switch.yaml
    input:
      inovelli_switch: 3eed85f7ca546a7ed7e24b0cfc6c818b
      button_1:
      - action: switch.turn_off
        target:
          entity_id: switch.upstairs_bathroom_fan
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
      button_2:
      - action: switch.turn_on
        target:
          entity_id: switch.upstairs_bathroom_fan
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
      button_3:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override

# -----------------------------------------------------------------------------
# MANUAL OVERRIDE RESET - Clear fan override after 30 minutes
# -----------------------------------------------------------------------------
- id: '2nd_floor_bathroom_fan_override_reset'
  alias: 2nd Floor Bathroom - Reset Fan Manual Override
  description: 'Reset fan manual override after 30 minutes'
  mode: restart
  trigger:
    - platform: state
      entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
      to: 'on'
      for:
        minutes: 30
  action:
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.2nd_floor_bathroom_fan_manual_override
