- id: upstairs_bathroom_motion_v3
  alias: "Upstairs Bathroom â†’ Motion Lighting v3"
  description: "Motion lighting with day/night modes, 8 min timeout"
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "on"
      id: motion_on
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "off"
      for:
        minutes: 8
      id: motion_off
  action:
    - choose:
        # MOTION ON
        - conditions:
            - condition: trigger
              id: motion_on
          sequence:
            - choose:
                # NIGHT (11pm-6am) - Dim red
                - conditions:
                    - condition: time
                      after: "23:00:00"
                      before: "06:00:00"
                  sequence:
                    - service: light.turn_on
                      target:
                        entity_id: light.2nd_floor_bathroom
                      data:
                        brightness_pct: 8
                        rgb_color: [255, 30, 0]
                        transition: 1
              # DAY - Full brightness
              default:
                - service: light.turn_on
                  target:
                    entity_id: light.2nd_floor_bathroom
                  data:
                    brightness_pct: 100
                    transition: 1
        # MOTION OFF - Turn off
        - conditions:
            - condition: trigger
              id: motion_off
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.2nd_floor_bathroom
              data:
                transition: 5
