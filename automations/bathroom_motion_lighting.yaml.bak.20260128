# Bathroom Motion Lighting - 1st and 2nd Floor
# Updated: 2026-01-27 - Aligned with upstairs pattern: night red, AL integration

# =============================================================================
# 1ST FLOOR BATHROOM
# =============================================================================
- id: 1st_floor_bathroom_motion_lighting_v2
  alias: "1st Floor Bathroom → Motion Lighting"
  description: "Motion-activated with night red mode, AL integration"
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.1st_floor_bathroom_motion_combined
      to: "on"
      id: motion_on
    - platform: state
      entity_id: binary_sensor.1st_floor_bathroom_motion_combined
      to: "off"
      for:
        minutes: 8
      id: motion_off
  condition:
    - condition: state
      entity_id: input_boolean.bathroom_manual_override
      state: "off"
  action:
    - choose:
        # MOTION ON
        - conditions:
            - condition: trigger
              id: motion_on
          sequence:
            - choose:
                # NIGHT (10pm-6am) - Dim red for night vision
                - conditions:
                    - condition: state
                      entity_id: sensor.time_context
                      state: "night"
                  sequence:
                    - service: light.turn_on
                      target:
                        entity_id: light.1st_floor_bathroom
                      data:
                        brightness_pct: 8
                        rgb_color: [255, 30, 0]
                        transition: 1
              # DAY/EVENING - Adaptive lighting
              default:
                - service: light.turn_on
                  target:
                    entity_id: light.1st_floor_bathroom
        # MOTION OFF - Fade out
        - conditions:
            - condition: trigger
              id: motion_off
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.1st_floor_bathroom
              data:
                transition: 5

- id: 1st_floor_bathroom_override_reset
  alias: "1st Floor Bathroom → Override Auto-Reset"
  description: "Reset manual override when bathroom light turns off"
  mode: single
  trigger:
    - platform: state
      entity_id: light.1st_floor_bathroom
      to: "off"
  condition:
    - condition: state
      entity_id: input_boolean.bathroom_manual_override
      state: "on"
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.bathroom_manual_override

# =============================================================================
# 2ND FLOOR BATHROOM - Keep in sync with upstairs_lighting.yaml
# Note: Primary automation now in packages/upstairs_lighting.yaml
# This is a backup/fallback using different motion sensor
# =============================================================================
- id: 2nd_floor_bathroom_motion_lighting_fallback
  alias: "2nd Floor Bathroom → Motion Lighting (Fallback)"
  description: "Fallback using upstairs_bathroom_motion sensor"
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "on"
      id: motion_on
    - platform: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      to: "off"
      for:
        minutes: 8
      id: motion_off
  condition:
    - condition: state
      entity_id: input_boolean.bathroom_manual_override
      state: "off"
    # Only trigger if main automation hasn't already turned on the light
    - condition: or
      conditions:
        - condition: trigger
          id: motion_off
        - condition: state
          entity_id: light.2nd_floor_bathroom
          state: "off"
  action:
    - choose:
        - conditions:
            - condition: trigger
              id: motion_on
          sequence:
            - choose:
                - conditions:
                    - condition: state
                      entity_id: sensor.time_context
                      state: "night"
                  sequence:
                    - service: light.turn_on
                      target:
                        entity_id: light.2nd_floor_bathroom
                      data:
                        brightness_pct: 8
                        rgb_color: [255, 30, 0]
                        transition: 1
              default:
                - service: light.turn_on
                  target:
                    entity_id: light.2nd_floor_bathroom
        - conditions:
            - condition: trigger
              id: motion_off
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.2nd_floor_bathroom
              data:
                transition: 5

- id: 2nd_floor_bathroom_override_reset
  alias: "2nd Floor Bathroom → Override Auto-Reset"
  mode: single
  trigger:
    - platform: state
      entity_id: light.2nd_floor_bathroom
      to: "off"
  condition:
    - condition: state
      entity_id: input_boolean.bathroom_manual_override
      state: "on"
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.bathroom_manual_override
