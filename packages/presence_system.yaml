# ═══════════════════════════════════════════════════════════
# Presence Detection System - 40154 Hwy 53
# Multi-method detection: WiFi + Motion + Geo + Mobile App
# Created: 2026-01-19
# ═══════════════════════════════════════════════════════════

input_boolean:
  # Individual presence
  john_home:
    name: "John Home"
    icon: mdi:account
  
  alaina_home:
    name: "Alaina Home"
    icon: mdi:account
  
  ella_home:
    name: "Ella Home"
    icon: mdi:account
  
  michelle_home:
    name: "Michelle Home"
    icon: mdi:account
  
  # Composite states
  someone_home:
    name: "Someone Home"
    icon: mdi:home-account
  
  girls_home:
    name: "Girls Home (Any)"
    icon: mdi:account-multiple
  
  both_girls_home:
    name: "Both Girls Home"
    icon: mdi:account-multiple
  
  john_and_girls:
    name: "John + Girls Home"
    icon: mdi:home-group
  
  john_and_michelle:
    name: "John + Michelle Home"
    icon: mdi:home-heart
  
  full_house:
    name: "Full House (John + Girls + Michelle)"
    icon: mdi:home-group
  
  # Activity tracking
  recent_motion:
    name: "Recent Motion Detected"
    icon: mdi:motion-sensor

# ═══════════════════════════════════════════════════════════
# BINARY SENSORS

# ═══════════════════════════════════════════════════════════
# TEMPLATE SENSORS (Modern Format)
# ═══════════════════════════════════════════════════════════

template:
  - binary_sensor:
      - name: "House Motion Active"
        unique_id: house_motion_active
        device_class: motion
        state: >
          {{
            is_state('binary_sensor.aqara_motion_sensor_p1_occupancy', 'on') or
            is_state('binary_sensor.garage_north_wall_nightlight_motion', 'on') or
            is_state('binary_sensor.ratgdo32disco_5735e8_motion', 'on') or
            is_state('binary_sensor.ratgdo32disco_fd8d8c_motion', 'on')
          }}
        icon: mdi:motion-sensor

  - sensor:
      - name: "People Home Count"
        unique_id: people_home_count_sensor
        state: >
          {% set count = 0 %}
          {% if is_state('input_boolean.john_home', 'on') %}{% set count = count + 1 %}{% endif %}
          {% if is_state('input_boolean.alaina_home', 'on') %}{% set count = count + 1 %}{% endif %}
          {% if is_state('input_boolean.ella_home', 'on') %}{% set count = count + 1 %}{% endif %}
          {% if is_state('input_boolean.michelle_home', 'on') %}{% set count = count + 1 %}{% endif %}
          {{ count }}
        icon: mdi:counter
      
      - name: "House Occupancy State"
        unique_id: house_occupancy_state_sensor
        state: >
          {% set john = is_state('input_boolean.john_home', 'on') %}
          {% set alaina = is_state('input_boolean.alaina_home', 'on') %}
          {% set ella = is_state('input_boolean.ella_home', 'on') %}
          {% set michelle = is_state('input_boolean.michelle_home', 'on') %}
          
          {% if john and alaina and ella and michelle %}
            Full House
          {% elif john and alaina and ella %}
            John + Girls
          {% elif john and michelle %}
            John + Michelle
          {% elif alaina and ella %}
            Girls Only
          {% elif john %}
            John Only
          {% elif alaina %}
            Alaina Only
          {% elif ella %}
            Ella Only
          {% elif michelle %}
            Michelle Only
          {% elif john and alaina %}
            John + Alaina
          {% elif john and ella %}
            John + Ella
          {% else %}
            Empty
          {% endif %}
        icon: >
          {% set count = states('sensor.people_home_count') | int %}
          {% if count == 0 %}mdi:home-outline
          {% elif count == 1 %}mdi:home-account
          {% elif count == 2 %}mdi:home-group
          {% else %}mdi:home-group-plus
          {% endif %}

# ═══════════════════════════════════════════════════════════
# AUTOMATIONS
# ═══════════════════════════════════════════════════════════

automation:
  # ─────────────────────────────────────────────────────────
  # JOHN'S PRESENCE (Mobile App + Person Entity)
  # ─────────────────────────────────────────────────────────
  
  - id: john_home_detection
    alias: "Presence → John Home"
    description: "Detect John at home via mobile app or person entity"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.john_spencer
        to: "home"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.john_home
  
  - id: john_away_detection
    alias: "Presence → John Away"
    description: "Detect John left home"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.john_spencer
        to: "not_home"
        for:
          minutes: 2
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.john_home

  # ─────────────────────────────────────────────────────────
  # ALAINA'S PRESENCE
  # ─────────────────────────────────────────────────────────
  
  - id: alaina_home_detection
    alias: "Presence → Alaina Home"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.alaina_spencer
        to: "home"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.alaina_home
  
  - id: alaina_away_detection
    alias: "Presence → Alaina Away"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.alaina_spencer
        to: "not_home"
        for:
          minutes: 2
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.alaina_home

  # ─────────────────────────────────────────────────────────
  # ELLA'S PRESENCE
  # ─────────────────────────────────────────────────────────
  
  - id: ella_home_detection
    alias: "Presence → Ella Home"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.ella_spencer
        to: "home"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.ella_home
  
  - id: ella_away_detection
    alias: "Presence → Ella Away"
    mode: restart
    trigger:
      - platform: state
        entity_id: person.ella_spencer
        to: "not_home"
        for:
          minutes: 2
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.ella_home

  # ─────────────────────────────────────────────────────────
  # MICHELLE'S PRESENCE (WiFi-based - no person entity)
  # NOTE: You'll need to find her device_tracker entity
  # ─────────────────────────────────────────────────────────
  
  - id: michelle_home_detection
    alias: "Presence → Michelle Home"
    description: "Detect Michelle via WiFi - UPDATE with her device_tracker"
    mode: restart
    trigger:
      # TODO: Replace with Michelle's actual device_tracker
      - platform: state
        entity_id: binary_sensor.michelle_actually_home
        to: "on"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.michelle_home
  
  - id: michelle_away_detection
    alias: "Presence → Michelle Away"
    mode: restart
    trigger:
      - platform: state
        entity_id: binary_sensor.michelle_actually_home
        to: "off"
        for:
          minutes: 10
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.michelle_home

  # ─────────────────────────────────────────────────────────
  # COMPOSITE PRESENCE UPDATES
  # ─────────────────────────────────────────────────────────
  
  - id: update_girls_home_status
    alias: "Presence → Update Girls Status"
    mode: restart
    trigger:
      - platform: state
        entity_id:
          - input_boolean.alaina_home
          - input_boolean.ella_home
    action:
      # At least one girl home
      - if:
          - or:
              - condition: state
                entity_id: input_boolean.alaina_home
                state: "on"
              - condition: state
                entity_id: input_boolean.ella_home
                state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.girls_home
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.girls_home
      
      # Both girls home
      - if:
          - condition: state
            entity_id: input_boolean.alaina_home
            state: "on"
          - condition: state
            entity_id: input_boolean.ella_home
            state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.both_girls_home
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.both_girls_home
  
  - id: update_occupancy_combinations
    alias: "Presence → Update Occupancy Combinations"
    mode: restart
    trigger:
      - platform: state
        entity_id:
          - input_boolean.john_home
          - input_boolean.girls_home
          - input_boolean.michelle_home
    action:
      # John + Girls
      - if:
          - condition: state
            entity_id: input_boolean.john_home
            state: "on"
          - condition: state
            entity_id: input_boolean.girls_home
            state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.john_and_girls
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.john_and_girls
      
      # John + Michelle
      - if:
          - condition: state
            entity_id: input_boolean.john_home
            state: "on"
          - condition: state
            entity_id: input_boolean.michelle_home
            state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.john_and_michelle
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.john_and_michelle
      
      # Full House
      - if:
          - condition: state
            entity_id: input_boolean.john_home
            state: "on"
          - condition: state
            entity_id: input_boolean.both_girls_home
            state: "on"
          - condition: state
            entity_id: input_boolean.michelle_home
            state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.full_house
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.full_house
  
  - id: update_someone_home
    alias: "Presence → Update Someone Home"
    mode: restart
    trigger:
      - platform: state
        entity_id:
          - input_boolean.john_home
          - input_boolean.alaina_home
          - input_boolean.ella_home
          - input_boolean.michelle_home
    action:
      - if:
          - or:
              - condition: state
                entity_id: input_boolean.john_home
                state: "on"
              - condition: state
                entity_id: input_boolean.alaina_home
                state: "on"
              - condition: state
                entity_id: input_boolean.ella_home
                state: "on"
              - condition: state
                entity_id: input_boolean.michelle_home
                state: "on"
        then:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.someone_home
        else:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.someone_home

  # ─────────────────────────────────────────────────────────
  # MOTION-BASED ACTIVITY TRACKING
  # ─────────────────────────────────────────────────────────
  
  - id: recent_motion_detected
    alias: "Activity → Recent Motion Detected"
    mode: restart
    trigger:
      - platform: state
        entity_id: binary_sensor.house_motion_active
        to: "on"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.recent_motion
      - delay:
          minutes: 15
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.recent_motion

template:

# =============================================================================

  - binary_sensor:
      # John sleeping/in bed detection
      - name: "John Sleeping"
        unique_id: john_sleeping
        state: >
          {% set on_2nd_floor_ap = state_attr('device_tracker.john_s_s24_ultra_4', 'ap_mac') == '70:a7:41:c6:1e:6c' %}
          {% set charging = states('sensor.john_s_phone_battery_state') in ['charging', 'Charging', 'full', 'Full'] %}
          {% set after_bedtime = now().hour >= 21 or now().hour < 7 %}
          {{ on_2nd_floor_ap and charging and after_bedtime }}
        device_class: occupancy
        icon: mdi:sleep

      # Alaina in bed detection  
      - name: "Alaina In Bed"
        unique_id: alaina_in_bed
        state: >
          {% set on_2nd_floor_ap = state_attr('device_tracker.alaina_s_iphone', 'ap_mac') == '70:a7:41:c6:1e:6c' %}
          {% set charging = states('sensor.alainas_iphone_battery_state') in ['charging', 'Charging', 'full', 'Full'] %}
          {% set at_home = is_state('input_boolean.alaina_home', 'on') %}
          {{ at_home and on_2nd_floor_ap and charging }}
        device_class: occupancy
        icon: mdi:sleep

      # Ella in bed detection
      - name: "Ella In Bed"
        unique_id: ella_in_bed
        state: >
          {% set on_2nd_floor_ap = state_attr('device_tracker.unifi_default_4a_7c_ea_7a_12_e0', 'ap_mac') == '70:a7:41:c6:1e:6c' %}
          {% set charging = states('sensor.ellas_iphone_battery_state') in ['charging', 'Charging', 'full', 'Full'] %}
          {% set at_home = is_state('input_boolean.ella_home', 'on') %}
          {{ at_home and on_2nd_floor_ap and charging }}
        device_class: occupancy
        icon: mdi:sleep

      # Girls heading to bed (on 2nd floor AP, home, evening hours)
      - name: "Girls Heading to Bed"
        unique_id: girls_heading_to_bed
        state: >
          {% set alaina_2nd = state_attr('device_tracker.alaina_s_iphone', 'ap_mac') == '70:a7:41:c6:1e:6c' %}
          {% set ella_2nd = state_attr('device_tracker.unifi_default_4a_7c_ea_7a_12_e0', 'ap_mac') == '70:a7:41:c6:1e:6c' %}
          {% set alaina_home = is_state('input_boolean.alaina_home', 'on') %}
          {% set ella_home = is_state('input_boolean.ella_home', 'on') %}
          {% set evening = now().hour >= 19 or now().hour < 1 %}
          {{ evening and ((alaina_home and alaina_2nd) or (ella_home and ella_2nd)) }}
        device_class: occupancy
        icon: mdi:bed-clock

      # Kids asleep (both in bed and charging)
      - name: "Kids Asleep"
        unique_id: kids_asleep
        state: >
          {% set alaina_sleeping = is_state('binary_sensor.alaina_in_bed', 'on') %}
          {% set ella_sleeping = is_state('binary_sensor.ella_in_bed', 'on') %}
          {% set alaina_home = is_state('input_boolean.alaina_home', 'on') %}
          {% set ella_home = is_state('input_boolean.ella_home', 'on') %}
          {% set both_home = alaina_home and ella_home %}
          {% set one_home = alaina_home != ella_home %}
          {% if both_home %}
            {{ alaina_sleeping and ella_sleeping }}
          {% elif one_home %}
            {{ (alaina_home and alaina_sleeping) or (ella_home and ella_sleeping) }}
          {% else %}
            false
          {% endif %}
        device_class: occupancy
        icon: mdi:sleep

# =============================================================================
# GIRLS AT MOM'S HOUSE DETECTION
# =============================================================================

  - binary_sensor:
      - name: "Alaina at Mom's"
        unique_id: alaina_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-account

      - name: "Ella at Mom's"
        unique_id: ella_at_moms
        state: >
          {{ is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-account

      - name: "Both Girls at Mom's"
        unique_id: both_girls_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") and is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-group

      - name: "Any Girl at Mom's"
        unique_id: any_girl_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") or is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-group

      - name: "Girls Location Summary"
        unique_id: girls_location_summary
        state: >
          {% set alaina = states('person.alaina_spencer') %}
          {% set ella = states('person.ella_spencer') %}
          {% if alaina == ella %}
            {{ 'Both at ' ~ alaina }}
          {% else %}
            {{ 'Alaina: ' ~ alaina ~ ', Ella: ' ~ ella }}
          {% endif %}
        icon: mdi:map-marker-multiple

# =============================================================================
# GIRLS AT MOM'S HOUSE DETECTION
# =============================================================================

  - binary_sensor:
      - name: "Alaina at Mom's"
        unique_id: alaina_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-account

      - name: "Ella at Mom's"
        unique_id: ella_at_moms
        state: >
          {{ is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-account

      - name: "Both Girls at Mom's"
        unique_id: both_girls_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") and is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-group

      - name: "Any Girl at Mom's"
        unique_id: any_girl_at_moms
        state: >
          {{ is_state('person.alaina_spencer', "Traci's House") or is_state('person.ella_spencer', "Traci's House") }}
        device_class: presence
        icon: mdi:home-group

      - name: "Girls Location Summary"
        unique_id: girls_location_summary
        state: >
          {% set alaina = states('person.alaina_spencer') %}
          {% set ella = states('person.ella_spencer') %}
          {% if alaina == ella %}
            {{ 'Both at ' ~ alaina }}
          {% else %}
            {{ 'Alaina: ' ~ alaina ~ ', Ella: ' ~ ella }}
          {% endif %}
        icon: mdi:map-marker-multiple

      - name: "Alaina at School"
        unique_id: alaina_at_school
        state: >
          {{ is_state('person.alaina_spencer', 'Whitehall School') }}
        device_class: presence
        icon: mdi:school

      - name: "Ella at School"
        unique_id: ella_at_school
        state: >
          {{ is_state('person.ella_spencer', 'Whitehall School') }}
        device_class: presence
        icon: mdi:school

      - name: "Both Girls at School"
        unique_id: both_girls_at_school
        state: >
          {{ is_state('person.alaina_spencer', 'Whitehall School') and is_state('person.ella_spencer', 'Whitehall School') }}
        device_class: presence
        icon: mdi:school

      - name: "Any Girl at School"
        unique_id: any_girl_at_school
        state: >
          {{ is_state('person.alaina_spencer', 'Whitehall School') or is_state('person.ella_spencer', 'Whitehall School') }}
        device_class: presence
        icon: mdi:school

# =============================================================================
# FLOOR LOCATION SENSORS - Based on UniFi AP Association
# =============================================================================
# AP MAC Reference:
#   2nd_floor_ap: 70:a7:41:c6:1e:6c (upstairs - bedrooms/bathroom)
#   1st_floor_ap: d0:21:f9:eb:b8:8c (main floor)
#   garage_ap:    f4:92:bf:69:53:f0 (garage)
# =============================================================================
  - sensor:
      - name: "John Floor Location"
        unique_id: john_floor_location
        state: >
          {% set ap_mac = state_attr('device_tracker.john_s_s24_ultra_4', 'ap_mac') %}
          {% if ap_mac == '70:a7:41:c6:1e:6c' %}
            2nd_floor
          {% elif ap_mac == 'd0:21:f9:eb:b8:8c' %}
            1st_floor
          {% elif ap_mac == 'f4:92:bf:69:53:f0' %}
            garage
          {% elif ap_mac is none or ap_mac == '' %}
            away
          {% else %}
            unknown
          {% endif %}
        icon: >
          {% set floor = this.state %}
          {% if floor == '2nd_floor' %}
            mdi:home-floor-2
          {% elif floor == '1st_floor' %}
            mdi:home-floor-1
          {% elif floor == 'garage' %}
            mdi:garage
          {% else %}
            mdi:help-circle
          {% endif %}

      - name: "Alaina Floor Location"
        unique_id: alaina_floor_location
        state: >
          {% set ap_mac = state_attr('device_tracker.alaina_s_iphone', 'ap_mac') %}
          {% if ap_mac == '70:a7:41:c6:1e:6c' %}
            2nd_floor
          {% elif ap_mac == 'd0:21:f9:eb:b8:8c' %}
            1st_floor
          {% elif ap_mac == 'f4:92:bf:69:53:f0' %}
            garage
          {% elif ap_mac is none or ap_mac == '' %}
            away
          {% else %}
            unknown
          {% endif %}
        icon: >
          {% set floor = this.state %}
          {% if floor == '2nd_floor' %}
            mdi:home-floor-2
          {% elif floor == '1st_floor' %}
            mdi:home-floor-1
          {% elif floor == 'garage' %}
            mdi:garage
          {% else %}
            mdi:help-circle
          {% endif %}

      - name: "Ella Floor Location"
        unique_id: ella_floor_location
        state: >
          {% set ap_mac = state_attr('device_tracker.unifi_default_4a_7c_ea_7a_12_e0', 'ap_mac') %}
          {% if ap_mac == '70:a7:41:c6:1e:6c' %}
            2nd_floor
          {% elif ap_mac == 'd0:21:f9:eb:b8:8c' %}
            1st_floor
          {% elif ap_mac == 'f4:92:bf:69:53:f0' %}
            garage
          {% elif ap_mac is none or ap_mac == '' %}
            away
          {% else %}
            unknown
          {% endif %}
        icon: >
          {% set floor = this.state %}
          {% if floor == '2nd_floor' %}
            mdi:home-floor-2
          {% elif floor == '1st_floor' %}
            mdi:home-floor-1
          {% elif floor == 'garage' %}
            mdi:garage
          {% else %}
            mdi:help-circle
          {% endif %}

  - binary_sensor:
      # John upstairs - useful for automations
      - name: "John Upstairs"
        unique_id: john_upstairs
        state: "{{ is_state('sensor.john_floor_location', '2nd_floor') }}"
        device_class: occupancy
        icon: mdi:home-floor-2

      # Anyone upstairs
      - name: "Anyone Upstairs"
        unique_id: anyone_upstairs
        state: >
          {{ is_state('sensor.john_floor_location', '2nd_floor')
             or is_state('sensor.alaina_floor_location', '2nd_floor')
             or is_state('sensor.ella_floor_location', '2nd_floor') }}
        device_class: occupancy
        icon: mdi:home-floor-2

      # Upstairs occupied (someone there + motion recently)
      - name: "Upstairs Occupied"
        unique_id: upstairs_occupied
        state: >
          {% set someone_upstairs = is_state('binary_sensor.anyone_upstairs', 'on') %}
          {% set recent_motion = is_state('binary_sensor.upstairs_hallway_motion', 'on')
                                 or is_state('binary_sensor.upstairs_bathroom_motion', 'on') %}
          {{ someone_upstairs or recent_motion }}
        device_class: occupancy
        icon: mdi:motion-sensor

# =============================================================================
# MICHELLE LOCATION SENSORS
# =============================================================================
  - binary_sensor:
      - name: "Michelle at John's House"
        unique_id: michelle_at_johns_house
        state: >
          {{ is_state('person.michelle', 'home') and 
             not is_state('binary_sensor.michelle_phone_at_michelle_s_house_40062', 'on') }}
        device_class: presence
        icon: mdi:home-account

      - name: "Michelle at Her House"
        unique_id: michelle_at_her_house
        state: >
          {{ is_state('binary_sensor.michelle_phone_at_michelle_s_house_40062', 'on') or
             is_state('person.michelle', "Michelle's House 40062 US Hwy 53") }}
        device_class: presence
        icon: mdi:home

      - name: "Michelle Home Anywhere"
        unique_id: michelle_home_anywhere
        state: >
          {{ is_state('binary_sensor.michelle_at_johns_house', 'on') or
             is_state('binary_sensor.michelle_at_her_house', 'on') }}
        device_class: presence
        icon: mdi:home-heart

  - sensor:
      - name: "Michelle Location"
        unique_id: michelle_location_friendly
        state: >
          {% if is_state('binary_sensor.michelle_phone_at_michelle_s_house_40062', 'on') %}
            Her House
          {% elif is_state('person.michelle', 'home') %}
            John's House
          {% else %}
            {{ states('person.michelle') }}
          {% endif %}
        icon: mdi:map-marker

# =============================================================================
# GIRLS LOCATION SENSORS (Friendly)
# =============================================================================
  - sensor:
      - name: "Alaina Location"
        unique_id: alaina_location_friendly
        state: >
          {% if is_state('person.alaina_spencer', 'Whitehall School') %}
            School
          {% elif is_state('person.alaina_spencer', "Traci's House") %}
            Mom's
          {% elif is_state('person.alaina_spencer', 'home') %}
            Home
          {% else %}
            {{ states('person.alaina_spencer') }}
          {% endif %}
        icon: >
          {% if is_state('person.alaina_spencer', 'Whitehall School') %}
            mdi:school
          {% elif is_state('person.alaina_spencer', "Traci's House") %}
            mdi:home-heart
          {% elif is_state('person.alaina_spencer', 'home') %}
            mdi:home
          {% else %}
            mdi:map-marker
          {% endif %}

      - name: "Ella Location"
        unique_id: ella_location_friendly
        state: >
          {% if is_state('person.ella_spencer', 'Whitehall School') %}
            School
          {% elif is_state('person.ella_spencer', "Traci's House") %}
            Mom's
          {% elif is_state('person.ella_spencer', 'home') %}
            Home
          {% else %}
            {{ states('person.ella_spencer') }}
          {% endif %}
        icon: >
          {% if is_state('person.ella_spencer', 'Whitehall School') %}
            mdi:school
          {% elif is_state('person.ella_spencer', "Traci's House") %}
            mdi:home-heart
          {% elif is_state('person.ella_spencer', 'home') %}
            mdi:home
          {% else %}
            mdi:map-marker
          {% endif %}

      - name: "John Location"
        unique_id: john_location_friendly
        state: >
          {% if is_state('input_boolean.john_home', 'on') %}
            Home
          {% elif is_state('person.john_spencer', 'TCHCC') %}
            Work
          {% else %}
            {{ states('person.john_spencer') }}
          {% endif %}
        icon: >
          {% if is_state('input_boolean.john_home', 'on') %}
            mdi:home
          {% elif is_state('person.john_spencer', 'TCHCC') %}
            mdi:hospital-building
          {% else %}
            mdi:map-marker
          {% endif %}
